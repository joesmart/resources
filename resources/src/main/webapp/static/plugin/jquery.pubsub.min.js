/**
 * Copyright (c) 2012 Joseph Zimmerman http://joezimjs.com
 * 
 * This script is licensed under the 
 * GNU General Public License, version 3 (GPL-3.0)
 * http://www.opensource.org/licenses/gpl-3.0.html
 *
 * Joe Zim's jQuery Pub/Sub Plugin (JZ Publish/Subscribe)
 * Version: 1.3
 * Supported jQuery Versions: 1.4.3+
 */
;(function(b){var d={},a={},c=false;b.subscribe=function(i,h,e){var g,f={};e=e||a;if(b.type(i)!=="string"||!b.isFunction(h)){return null}g=i.split(" ");b.each(g,function(k,j){if(j===""||f[j]){return true}else{f[j]=true}if(!d[j]){d[j]=[]}d[j].push([h,e])});return{topics:i,callback:h,context:e}};b.unsubscribe=function(i,h,e){if(c){b.unsubscribe.queue.push([i,h,e]);return b}var g,f={};if(!i||(b.type(i)!=="string"&&(!i.topics||b.type(i.topics)!=="string"))){return b}if(i.topics){h=h||i.callback;e=e||i.context;i=i.topics}e=e||a;g=i.split(" ");b.each(g,function(k,j){var l=d[j];if(j===""||!l||f[j]){return true}else{f[j]=true}if(!h||!b.isFunction(h)){delete d[j]}else{b.each(l,function(m,n){if(n[0]===h&&n[1]===e){l.splice(m,1);return false}})}});return b};b.unsubscribe.queue=[];b.unsubscribe.resume=function(){if(c){return}var f;while(f=b.unsubscribe.queue.shift()){console.log("retry unsubscribe ",f);b.unsubscribe(f[0],f[1],f[2])}};b.publish=function(g,f){c=true;if(!g||b.type(g)!=="string"){return b}var e=g.split(" ");b.each(e,function(j,h){if(h===""){return true}if(d[h]){b.each(d[h],function(k,l){l[0].call(l[1],h,f)})}});c=false;b.unsubscribe.resume();return b}}(jQuery));